// partial translation of FontPanel.h//  rp 20090227include "Tlbx CarbonEvents.incl"include "Tlbx Fonts.incl"#if ndef _DEFINEDINCARBONbegin record FMFontFamilyInstancedim as FMFontFamily  fontFamilydim as FMFontStyle   fontStyleend record_kHICommandShowHideFontPanel  = _"shfp"_kEventClassFont              = _"font"_kEventFontPanelClosed        = 1_kEventFontSelection          = 2_typeATSUFontID           = _"magn" /* ATSUI font ID.*/_typeATSUSize             = _"fixd" /* ATSUI font size.*/_typeFMFontFamily         = _"shor" /* Font family reference.*/_typeFMFontStyle          = _"shor" /* Quickdraw font style*/_typeFMFontSize           = _"shor" /* Integer font size.*/_typeFontColor            = _"cRGB" /* Font color spec (optional).*/_kEventParamATSUFontID    = _"auid" /* typeATSUFontID*/_kEventParamATSUFontSize  = _"ausz" /* typeATSUSize*/_kEventParamFMFontFamily  = _"fmfm" /* typeFMFontFamily*/_kEventParamFMFontStyle   = _"fmst" /* typeFMFontStyle*/_kEventParamFMFontSize    = _"fmsz" /* typeFMFontSize*/_kEventParamFontColor     = _"fclr" /* typeFontColor*/_kEventParamDictionary    = _"dict" /* typeCFDictionaryRef*//*fontPanelShowErr = -8880 fontPanelSelectionStyleErr = -8881 fontPanelFontSelectionQDStyleVersionErr = -8882*/_kFontSelectionATSUIType = _"astl"_kFontSelectionQDType    = _"qstl"_kFontSelectionCoreTextType = _"ctfd"_kFontSelectionQDStyleVersionZero = 0begin record FontSelectionQDStyledim as UInt32                version /* Version number of struct.*/dim as FMFontFamilyInstance  instance /* Font instance data.*/dim as FMFontSize            size /* Size of font in points.*/dim as Boolean               hasColor /* true if color info supplied.*/dim as UInt8                 reserved /* Filler byte.*/dim as RGBColor              color /* Color specification for font.*/end record#endif /* _DEFINEDINCARBON */// AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATERtoolbox fn FPIsFontPanelVisible() = Booleantoolbox fn FPShowHideFontPanel()  = OSStatustoolbox fn SetFontInfoForSelection( OSType iStyleType, UInt32 iNumStyles, ptr *iStyles, EventTargetRef iFPEventTarget ) = OSStatus// last param was wrongly indicated as HIObjectRef in 10.3 headers/*  Colour support. See http://lists.apple.com/archives/Carbon-dev/2009/Jan/msg00135.html*/local fn GetFontColorEventParameter( theEvent as EventRef, outRGB as ^RGBColor  )dim as  OSStatus     resultBeginCCode CFDictionaryRef     dict, attrDict; CFDataRef           tags, values; ATSUAttributeTag    *tag; result = GetEventParameter( theEvent, kEventParamDictionary, typeCFDictionaryRef, NULL, sizeof( typeCFDictionaryRef ), NULL, &dict );    if ( result == noErr   && CFDictionaryGetValueIfPresent( dict, kFontPanelAttributesKey, (const void**)&attrDict )  && CFDictionaryGetValueIfPresent( attrDict, kFontPanelAttributeTagsKey, (const void**)&tags ) )    {    tag = (ATSUAttributeTag*)CFDataGetBytePtr( tags );    if ( *tag == kATSUColorTag )    {      CFDictionaryGetValueIfPresent( attrDict, kFontPanelAttributeValuesKey, (const void**)&values );      *outRGB = *(RGBColor*)CFDataGetBytePtr(values);    }    else result = eventParameterNotFoundErr;  }EndCend fn = result